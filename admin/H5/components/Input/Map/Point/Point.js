!function(t){window.components_Input_Map_Point_Point({component:!0,usingComponents:{}},{template:"#TEMPLATE_components_Input_Map_Point_Point",props:{name:{type:String,default:t.guid()},index:{type:Number},disabled:{type:Boolean,default:!1},value:{type:String,default:"",observer:function(t,e){this.fliter(t)}},attr:{type:Object,default:{}}},data:function(){return{value1:[],map:"",markers:{}}},methods:{fliter(e){if(e!=JSON.stringify(this.value1)&&this.map){this.map.clearMap(),this.markers={};let a=t.string(e).parse([]),i=this.getData("attr")||{};i.max=i.max||1,a.length>i.max&&(a=a.slice(a.length-i.max-1,a.length-1));for(let t=0;t<a.length;t++)this.addMarker(a[t])}},addMarker(e){let a=this.getData("attr")||{};return a.max=a.max||1,new Promise(t=>{let a=this.getData("attr").marker||{};"function"==typeof a?a(e,this.getData("name")).then(e=>{t(e)}):t(a)}).then(i=>new Promise(n=>{var s=new AMap.Marker({position:new AMap.LngLat(e[0],e[1]),...i});s.on("click",a=>{this.getData("disabled")?this.triggerEvent("click",{event:a,type:"marker",id:this.getData("name"),index:this.getData("index")}):t.confirm("删除坐标点?").then(()=>{let t=[];for(let a=0;a<this.value1.length;a++)this.value1[a][0]==e[0]&&this.value1[a][1]==e[1]||t.push([this.value1[a][0],this.value1[a][1]]);this.value1=t,this.map.remove(s),delete this.markers[a.target._amap_id],this.triggerEvent("change",{value:t.length?JSON.stringify(t):"",detail:{type:"markerDelete",longitude:e[0],latitude:e[1]},id:this.getData("name"),index:this.getData("index")})})}),1==a.max?this.value1=[e]:this.value1.push(e),this.map.setCenter(e),this.markers[s._amap_id]=s,this.map.add(s),n()}))},addPonit(e,a){let i=this.getData("attr")||{};i.max=i.max||1,1==i.max?this.addMarker([e,a]).then(()=>{this.triggerEvent("change",{value:this.value1.length?JSON.stringify(this.value1):"",type:"markerMove",longitude:e,latitude:a,id:this.getData("name"),index:this.getData("index")})}):t.confirm("标记坐标点?").then(()=>{this.addMarker([e,a]).then(()=>{this.triggerEvent("change",{value:this.value1.length?JSON.stringify(this.value1):"",type:"markerAdd",longitude:e,latitude:a,id:this.getData("name"),index:this.getData("index")})})})}},mounted:function(){let t=this.getData("attr")||{};t.max=t.max||1;let e=t.center||[106.51107,29.50197];if(this.map=new AMap.Map(this.getData("name"),{center:e,zoom:t.zoom||11}),this.value)this.fliter(this.value);else if(1==t.max){let t=JSON.stringify([e]);this.fliter(this.value||t)}this.map.on("click",e=>{let a=[e.lnglat.lng,e.lnglat.lat];if(this.getData("disabled"))this.triggerEvent("click",{event:e,type:"map",id:this.getData("name"),index:this.getData("index")});else{if(1==t.max||void 0===t.max){let t=JSON.stringify([a]);this.fliter(t)}this.addPonit(a[0],a[1])}})}})}(Y);