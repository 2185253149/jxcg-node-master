!function(t){window.components_Input_Map_Polygon_Polygon({component:!0,usingComponents:{}},{template:"#TEMPLATE_components_Input_Map_Polygon_Polygon",props:{name:{type:String,default:t.guid()},index:{type:Number},disabled:{type:Boolean,default:!1},value:{type:String,default:"",observer:function(t,e){this.fliter(t)}},attr:{type:Object,default:{max:10}}},data:function(){return{value1:[],firstValue:"",map:"",polyEditor:"",polygons:{},editing:!1}},methods:{fliter(e){if(e!=JSON.stringify(this.value1)&&this.map){this.map.clearMap(),this.polyEditor.close(),this.polygons={};let i=t.string(e).parse([]);for(let t=0;t<i.length;t++)this.addPolygon(i[t])}},save(){let t=[];for(let e in this.polygons){let i=this.polygons[e].getPath();for(let t=0;t<i.length;t++)i[t]=[i[t].lng,i[t].lat];t.push(i)}this.value1=t,this.triggerEvent("change",{value:t.length?JSON.stringify(t):"",type:"polygon",id:this.getData("name"),index:this.getData("index")}),this.editing=!1,this.polyEditor.close()},clear(){this.map.clearMap(),this.polyEditor.close(),this.polygons={},this.firstValue&&this.fliter(this.firstValue)},editPolygon(t){this.polyEditor.close(),this.polyEditor.addAdsorbPolygons(t),this.polyEditor.setTarget(t),this.polyEditor.open(),this.editing=!0},addPolygon(e){return new Promise(t=>{let e=this.getData("attr").polygon||{};"function"==typeof e?e(point,this.getData("name")).then(e=>{t(e)}):t(e)}).then(i=>new Promise(a=>{var o=new AMap.Polygon({path:e,strokeColor:"#FF33FF",strokeWeight:3,strokeOpacity:.2,fillOpacity:.4,fillColor:"#1791fc",zIndex:50,bubble:!0,...i});this.map.add([o]),this.map.setFitView(),this.getData("disabled")||this.editPolygon(o),o.on("click",t=>{this.getData("disabled")||this.editPolygon(t.target)}),o.on("dblclick",e=>{if(this.getData("disabled")){let t=this.polygons[e.target._amap_id].getPath();for(let e=0;e<t.length;e++)t[e]=[t[e].lng,t[e].lat];this.triggerEvent("click",{event:e,path:t,type:"polygon",id:this.getData("name"),index:this.getData("index")})}else t.confirm("删除标记区域?").then(()=>{this.map.remove(this.polygons[e.target._amap_id]),this.polyEditor.close(),delete this.polygons[e.target._amap_id]})}),this.polygons[o._amap_id]=o,a()}))}},mounted:function(){let e=this.getData("attr")||{};e.max=e.max||1,this.firstValue=this.value;let i=e.center||[106.51107,29.50197];this.map=new AMap.Map(this.getData("name"),{center:i,zoom:e.zoom||11});var a=new AMap.AutoComplete({input:"keyword"}),o=new AMap.PlaceSearch({map:this.map});AMap.Event.addListener(a,"select",t=>{o.setCity(t.poi.adcode),o.search(t.poi.name);t.poi}),AMap.Event.addListener(a,"error",t=>{console.log(t)}),this.polyEditor=new AMap.PolygonEditor(this.map),this.value&&this.fliter(this.value),this.map.on("rightclick",i=>{let a=[i.lnglat.lng,i.lnglat.lat],o=[a,[a[0]+1e-4,a[1]+1e-4],[a[0]+1e-4,a[1]+2e-4]];this.getData("disabled")||this.value1.length<e.max&&t.confirm("在此区域绘图?").then(()=>{this.addPolygon(o).then(()=>{this.triggerEvent("click",{value:this.value1.length?JSON.stringify(this.value1):"",detail:{type:"polygonAdd",path:o},id:this.getData("name"),index:this.getData("index")})})})})}})}(Y);