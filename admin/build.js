var fs=require("fs"),minConfig={removeComments:!0,collapseWhitespace:!0,minifyJS:!0,minifyCSS:!0},$={},min=!1;!function(e){var t;e.zIndex=(t=0,function(e){return 1e4*(e||4)+t++}),e.Vnode=function(){function t(i,n){for(var r in n=n||{},this.parentNode=null,this.childNodes=[],this.nextSibling=null,this.firstChild=null,this.lastChild=null,this._id_=e.zIndex(),this.attributes={},this.tagName=i,this.nodeType=1,this.nodeValue=null,n)this[r]=n[r];this.getAttribute=function(e){return this.attributes[e]},this.setAttribute=function(e,t){this.attributes[e]=t},this.removeAttribute=function(e){var t={};for(var i in this.attributes)i!=e&&(t[i]=this.attributes[i]);this.attributes=t},this.events={},this.addEventListener=function(e,t,i){this.events[e]||(this.events[e]={});var n=t.toString().match(/^function\s*([\S]*)\(/)[1]||"default";this.events[e][n]={func:t,useCapture:i}},this.removeEventListener=function(e,t){if(this.events[e])if(t){var i=t.toString().match(/^function\s*([\S]*)\(/)[1];i&&this.events[e][i]&&(this.events[e][i]=null)}else this.events[e]=null},this.attributesToString=function(){if(3===this.nodeType)return this.nodeValue;var e="<"+this.tagName+" ";for(var t in this.attributes)void 0!=this.attributes[t]&&(!0===this.attributes[t]?e+=t+" ":e+=t+'="'+this.attributes[t]+'" ');return e.replace(/ $/,"")+">"},this.toString=function(e){if("function"==typeof e&&e.call(this),3===this.nodeType)return this.nodeValue;for(var t="",i=0;i<this.childNodes.length;i++)t+=this.childNodes[i].toString(e);return this.attributesToString()+t+"</"+this.tagName+">"},this.appendChild=function(e){e.parentNode&&e.parentNode.removeChild(e),e.parentNode=this;var t=this.childNodes[this.childNodes.length-1];t&&(t.nextSibling=e),e.previousSibling=t,e.nextSibling=null,this.childNodes.push(e),1==this.childNodes.length&&(this.firstChild=e),this.lastChild=e},this.removeChild=function(e){for(var t=null,i=0;i<this.childNodes.length;i++)this.childNodes[i]._id_==e._id_&&(t=i);t>=0&&(e.previousSibling&&(e.previousSibling.nextSibling=e.nextSibling),e.nextSibling&&(e.nextSibling.previousSibling=e.previousSibling),this.childNodes.splice(t,1),e.parentNode=null,e.nextSibling=null,e.previousSibling=null)},this.insertBefore=function(e,t){if(t){for(var i=null,n=0;n<this.childNodes.length;n++)this.childNodes[n]._id_==t._id_&&(i=n);i>=0&&(e.parentNode&&e.parentNode.removeChild(e),t.previousSibling&&(t.previousSibling.nextSibling=e,e.previousSibling=t.previousSibling),e.nextSibling=t,t.previousSibling=e,e.parentNode=this,this.childNodes.splice(i,0,e))}else this.appendChild(e)},this.replaceChild=function(e,t){this.insertBefore(e,t),this.removeChild(t)},this.vnodeTree=function(){for(var e={attributes:this.attributes,tagName:this.tagName,nodeType:this.nodeType,nodeValue:this.nodeValue,childNodes:[]},t=0;t<this.childNodes.length;t++)e.childNodes.push(this.childNodes[t].vnodeTree());return e},this.cloneNode=function(e){return t.parseVnodeTree(this.vnodeTree())}}return t.parseVnodeTree=function(e){var i=new t(e.tagName);i.attributes=e.attributes,i.tagName=e.tagName,i.nodeType=e.nodeType,i.nodeValue=e.nodeValue,i.childNodes=[];for(var n=null,r=0;r<e.childNodes.length;r++){var s=t.parseVnodeTree(e.childNodes[r]);n&&(n.nextSibling=s),0==r&&(i.firstChild=s),r==e.childNodes.length-1&&(i.lastChild=s),s.parentNode=i,s.previousSibling=n,i.childNodes.push(s),n=s}return i},t.parseXml=function(e,i){var n,r,s=0,a="",o=!1,l={tagNameing:!1,attrNameing:!1,attrValueing:!1};function c(e){if(e)for(var t in o=!0,l)l[t]=t===e;else for(var t in o=!1,l)l[t]=!1}function p(e){var i=new t(e);n?n.appendChild(i):r=i,n=i,a="",c("attrNameing")}for(var u="";s<e.length;){var d=!1,f=e.charAt(s);switch(f){case"<":if(o)d=!0;else{if(a){var g=new t("");g.nodeType=3,g.nodeValue=a,n.appendChild(g)}a="",c("tagNameing")}break;case">":if(l.tagNameing){if("/"===a.charAt(0))if(n&&n.tagName===a.replace("/",""))n=n.parentNode,a="";else{var h=n.parentNode;h.removeChild(n),n=h,a="<"+a+">"}else p(a);c()}else l.attrValueing?'"'!==a.charAt(0)&&"'"!==a.charAt(0)||a.charAt([a.length-1])!==a.charAt(0)?d=!0:(n.setAttribute(u,a.replace(/^"/,"").replace(/^'/,"").replace(/"$/,"").replace(/'$/,"")),c(),a=""):l.attrNameing?(u=a.replace(" ",""),n.setAttribute(u,!0),a="",c()):d=!0;break;case"=":l.attrNameing?(u=a.replace(" ",""),a="",c("attrValueing")):l.attrValueing&&!a.replace(/\s/g,"")||(d=!0);break;case" ":l.tagNameing?"/"!==a.charAt(0)&&/\w$/.test(a)?p(a):d=!0:l.attrValueing?a.replace(/\s/g,"")&&('"'!==a.charAt(0)&&"'"!==a.charAt(0)||a.charAt([a.length-1])!==a.charAt(0)?d=!0:(n.setAttribute(u,a.replace(/^"/,"").replace(/^'/,"").replace(/"$/,"").replace(/'$/,"")),c("attrNameing"),a="")):l.attrNameing?(u=a.replace(" ",""),n.setAttribute(u,!0),c("attrValueing"),a=""):d=!0;break;default:l.attrValueing&&!a.replace(/\s/g,"")&&/\w/.test(f)&&c("attrNameing"),d=!0}d&&(a+=f),f,s++}return r},t}();var i,n=require("fs"),r=require("https"),s=require("http");function a(e,t){if("function"==typeof t)e=t(e);else if(t&&"object"==typeof t)for(var i in t)switch(typeof t[i]){case"string":e=e.replace?e.replace(new RegExp(i,"gmi"),t[i]):e;break;case"function":e=t[i](e,i)}return e}e.node={downLoad:function(e,t,r){i=i||require("request");var s=n.createWriteStream(t),a=i(e);a.pipe(s),a.on("end",function(){}),a.on("error",function(e){console.log("错误信息:"+e),r({errorMsg:JSON.stringify(e)})}),s.on("finish",function(){s.end(),r({})})},copyFile:function(e,t,i,r,s){var o=t.split("/"),l=o[o.length-1];/\./.test(l)&&o.pop();for(var c="",p=0;p<o.length;p++)if(o[p]){var u=c?"/"+o[p]:"/"==t.charAt(0)?"/"+o[p]:o[p];n.existsSync(c+u)||n.mkdirSync(c+u),c+=u}if(!/\./.test(l))return!1;var d=n.readFileSync(e,!1===s?null:s||"utf-8");"object"==typeof i?d=a(d,i):"function"==typeof i&&(d=i(d,e,t)),r&&(d=r(d)),null!=d&&void 0!=d&&n.writeFileSync(t,d)},fileReplace:a,copyFolder:function e(t,i,r,s){if(!n.existsSync(t))return!1;try{var o=n.readdirSync(t);if(o&&o.length){for(var l=i.split("/"),c=(l[l.length-1],""),p=0;p<l.length;p++)if(l[p]){var u=c?"/"+l[p]:"/"==i.charAt(0)?"/"+l[p]:l[p];n.existsSync(c+u)||n.mkdirSync(c+u),c+=u}for(p=0;p<o.length;p++)!function(l){if(-1===o[l].indexOf("."))e(t+"/"+o[l],i+"/"+o[l],r,s);else{var c=/\.(text)|(js)|(css)|(html)|(json)|(wxml)|(wxss)|(axml)|(acss)$/.test(o[l])?"utf-8":void 0,p=n.readFileSync(t+"/"+o[l],c);if("object"==typeof r?p=a(p,r):"function"==typeof r&&(p=r(p,t+"/"+o[l],i+"/"+o[l])),s&&(p=s(p,t+"/"+o[l],i+"/"+o[l])),null==p||void 0==p)return;n.writeFileSync(i+"/"+o[l],p)}}(p)}}catch(e){console.log(t,i,e)}},deleteFile:function(e){n.existsSync(e)&&n.rmdirSync(e)},deleteFolder:function e(t){n.existsSync(t)&&(n.readdirSync(t).forEach(function(i,r){var s=t+"/"+i;n.statSync(s).isDirectory()?e(s):n.unlinkSync(s)}),n.rmdirSync(t))},proxy:function(e){if(Config.proxy)if("string"==typeof e)for(let t in Config.proxy)e=e.replace(t,Config.proxy[t]);else if(e.url)for(let t in Config.proxy)e.url=e.url.replace(t,Config.proxy[t]);return e},get:function(e,t,i){e=this.proxy(e),i=i||"json",(0==e.indexOf("https://")?r:s).get(e,function(e){var n="";e.on("data",function(e){n+=e}),e.on("end",function(){t("json"==i?JSON.parse(n):n),n=""})})},fetch(e){return e=this.proxy(e),i=i||require("request"),new Promise(t=>{"string"==typeof e?this.get(e,t):(e.dataType=e.dataType||"json",i({url:e.url,method:e.method||"POST",headers:e.headers||{},body:"string"==typeof e.data?e.data:JSON.stringify(e.data)},function(i,n,r){t(i?{errorMsg:i.toString()}:"string"==typeof r&&"json"==e.dataType?JSON.parse(r):r)}))})},buildXML:function(e){return(new(require("xml2js").Builder)).buildObject(e)},parseXML:function(e,t){new(require("xml2js").Parser)({trim:!0,explicitArray:!1,explicitRoot:!1}).parseString(e,t||function(e,t){})},parseRaw:function(){return function(e,t,i){var n=[];e.on("data",function(e){n.push(e)}),e.on("end",function(){e.rawbody=Buffer.concat(n).toString("utf8"),i()}),e.on("error",function(e){i(e)})}},pipe:function(e,t){var i=[];e.on("data",function(e){i.push(e)}),e.on("end",function(){t(null,Buffer.concat(i))}),e.once("error",t)},mix:function(){var e=arguments[0];if(1==arguments.length)return e;for(var t=1;t<arguments.length;t++)for(var i in arguments[t])e[i]=arguments[t][i];return e},generateNonceString:function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=t.length,n="",r=0;r<(e||32);r++)n+=t.charAt(Math.floor(Math.random()*i));return n}},e.Version={createTime:1697505478655,authorize:0}}($);var builded={w_h:!1,w_a:!1,a_h:!1};function minify(e,t){return e}function build_w_h(e,t,n,r){if(!fs.existsSync(e)||!fs.existsSync(t)||builded.w_h)return!1;e+="/",t+="/",builded.w_h=!0,(r=r||{}).indexScript=r.indexScript||"\x3c!--  --\x3e",r.indexStyle=r.indexStyle||"\x3c!--  --\x3e";var s=fs.readFileSync(e+"app.json","utf-8");for($.node.copyFile(e+"common.wxss",t+"css/common.css",function(e){return e.replace(/\spage|^page/gim,".page").replace(/rpx/gim,"px")}),$.node.copyFile(e+"utils/common.js",t+"js/common.js",function(e){return e.replace(/const \$(.+)require(.+);/,"").replace(/\$\./gim,"Y.").replace(/module.exports/,"Y.common")}),$.node.copyFile(t+"index.html",t+"index.html",function(e){return r&&r.indexScript&&(e=e.replace(/\$\{indexScript\}/,r.indexScript)),r&&r.indexStyle&&(e=e.replace(/\$\{indexStyle\}/,r.indexStyle)),e.replace(/\?id=\d+__/gim,"?id="+(new Date).getTime()+"__")}),n&&($.node.copyFile(e+"config.js",t+"js/config.js",function(e){return e.replace(/wx\.\$/,"Y")}),$.node.copyFile(e+"app.js",t+"js/app.js",function(e){return(e=(e=e.replace(/require\(/g,"//require(")).replace("G.App({","G.App("+s+",{")).replace(/wx\.\$/,"Y")}),$.node.copyFile(e+"app.wxss",t+"css/app.css",function(e){return e.replace(/^page/gim,".page").replace(/\spage/gim," .page").replace(/rpx/gim,"px").replace(/@import\s[^;]+;/g,"")})),$.node.copyFolder(e+"images",t+"images"),$.node.copyFolder(e+"asset",t+"asset"),s=JSON.parse(s),r.nodemvc||n||(s.pages=s.pagesA),i=0;i<s.pages.length;i++)!function(i){try{var r=s.pages[i].split("/");r.pop(),r=r.join("/"),$.node.copyFile(e+r,t+r);var a=0==s.pages[i].indexOf("components/"),o=s.pages[i].replace(/\//g,"_"),l=fs.readFileSync(e+s.pages[i]+".js","utf-8"),c=fs.readFileSync(e+s.pages[i]+".json","utf-8");l=(l=(l=(l=l.replace(/\/\*/gim,"").replace(/\*\//gim,"")).replace("wx.$","Y")).replace(/wx\./gim,"G.")).replace(/G\.vue\(/,"G.vue("+c+",");var p=fs.readFileSync(e+s.pages[i]+".wxss","utf-8");p=p.replace(/@import\s[^;]+;/g,"");var u=fs.readFileSync(e+s.pages[i]+".wxml","utf-8");u=$.Vnode.parseXml(u).toString(function(){switch(this.tagName){case"view":this.tagName="div";break;case"text":this.tagName="span";break;case"switch":this.tagName="switch_";break;case"image":this.tagName="img";break;case"button":this.tagName="button_"}var e={};for(var t in this.attributes)if("wx:if"===t)e["v-if"]=this.attributes["wx:if"].replace("{{","").replace("}}","");else if("wx:elif"===t)e["v-else-if"]=this.attributes["wx:elif"].replace("{{","").replace("}}","");else if("wx:else"===t)e["v-else"]=!0;else if("wx:for"===t){var i=this.attributes["wx:for"].replace("{{","").replace("}}",""),n=this.attributes["wx:for-item"]||"item",r=this.attributes["wx:for-index"]||"index";e["v-for"]="("+n+","+r+") in "+i}else if("wx:key"===t)e.key=this.attributes["wx:key"];else if("bindtap"===t)e["@click"]=this.attributes.bindtap;else if("catchtap"===t)e["@click.stop"]=this.attributes.catchtap;else if("bindinput"===t)e["@change"]=this.attributes.bindinput;else if("bindlongpress"==t)e["@touchstart"]="on($event,'longpress','"+this.attributes.bindlongpress+"')";else{this.attributes[t];/^bind/.test(t)?e[t.replace("bind","@")]=this.attributes[t].replace("{{","").replace("}}",""):/^catch/.test(t)?e[t.replace("catch","@")+".stop"]=this.attributes[t].replace("{{","").replace("}}",""):/^\{\{.+\}\}$/.test(this.attributes[t])?e[":"+("id"===t?"ref":t)]=this.attributes[t].replace(/^\{\{/,"").replace(/\}\}$/,""):"style"==t?e[":"+t]="computStyle('"+this.attributes[t]+"')":"wx:for-item"!==t&&"wx:for-index"!==t&&(e["id"===t?"ref":t]=this.attributes[t])}this.attributes=e}),u=a?'<div class="'+o+'">\r\n'+u+"\r\n</div>":"<template>\r\n"+u+"\r\n</template>",a?l=l.replace("G.component({",'window["'+o+'"]('+c+",{\r\ntemplate:'#TEMPLATE_"+o+"',\r\n"):(u+='\r\n<script type="text/javascript">\r\n'+l+"\r\n<\/script>\r\n<style scoped>\r\n"+p+"\r\n</style>",l="",p=""),min&&n&&(u=minify(u,minConfig),p=minify(p,minConfig),l=minify(l,minConfig)),u&&fs.writeFileSync(t+s.pages[i]+".html",u),a&&fs.writeFileSync(t+s.pages[i]+".css","/* scoped */\r\n"+p),l&&fs.writeFileSync(t+s.pages[i]+".js",l)}catch(e){console.log("编译"+s.pages[i]+"出错!!!!"),console.log(e)}}(i)}function build_a_h(e,t,i,n){if(!fs.existsSync(e)||!fs.existsSync(t)||builded.w_h||builded.a_h)return!1;e+="/",t+="/",builded.a_h=!0;var r=JSON.parse(fs.readFileSync(e+"app.json","utf-8"));!n||n.nodemvc||i||(r.pages=r.pagesA),n.indexScript=n.indexScript||"\x3c!--  --\x3e",n.indexStyle=n.indexStyle||"\x3c!--  --\x3e",i&&($.node.copyFile(e+"config.js",t+"js/config.js",function(e){return e.replace(/my\.\$/,"Y").replace(/APIURL([^,]+),/g,"APIURL: '.',")}),$.node.copyFile(e+"app.js",t+"js/app.js",function(e){return e.replace(/my\.\$/,"Y")}),$.node.copyFile(e+"app.acss",t+"css/app.css",function(e){return e.replace(/^page/gim,".page").replace(/\spage/gim," .page").replace(/rpx/gim,"px").replace(/@import\s[^;]+;/g,"/*@import*/")})),$.node.copyFolder(e+"images",t+"images"),$.node.copyFolder(e+"assets",t+"assets"),$.node.copyFile(t+"index.html",t+"index.html",function(e){return n&&n.indexScript&&(e=e.replace(/\$\{indexScript\}/,n.indexScript)),n&&n.indexStyle&&(e=e.replace(/\$\{indexStyle\}/,n.indexStyle)),e.replace(/\?id=\d+__/gim,"?id="+(new Date).getTime()+"__")});for(var s=[],a={},o=0;o<r.pages.length;o++){var l=fs.readFileSync(e+r.pages[o]+".json","utf-8");if((l=JSON.parse(l)).usingComponents)for(var c in l.usingComponents){var p=l.usingComponents[c].replace(/\//g,"_");a[p]||(s.push(l.usingComponents[c].replace("/","")),a[p]=!0)}}for(r.pages=r.pages.concat(s),o=0;o<r.pages.length;o++)!function(n){var s=r.pages[n].split("/");s.pop(),s=s.join("/"),$.node.copyFile(e+s,t+s);var a=0==r.pages[n].indexOf("components/"),o=r.pages[n].replace(/\//g,"_"),l=fs.readFileSync(e+r.pages[n]+".js","utf-8"),c=fs.readFileSync(e+r.pages[n]+".json","utf-8");l=(l=(l=(l=l.replace(/\/\*/gim,"").replace(/\*\//gim,"")).replace("my.$","Y")).replace(/my\./gim,"G.")).replace(/G\.vue\(\{/,'G.vue("'+o+'",'+c+",{");var p=fs.readFileSync(e+r.pages[n]+".acss","utf-8"),u=a?".":"#";p=(p=(p=(p=(p=(p=p.replace(/([\.#]?.+){/gim,u+o+" $1{").replace(/,([\.#]?.+){/gim,","+u+o+" $1{")).replace(new RegExp(u+o+" .Web","gmi"),".Web "+u+o)).replace(new RegExp(u+o+" .iOS","gmi"),".iOS "+u+o)).replace(new RegExp(u+o+" .Android","gmi"),".Android "+u+o)).replace(/rpx/gim,"px").replace(/^page|\spage/gim,"")).replace(/scoped/gim,"").replace(/@import\s[^;]+;/g,"");var d=fs.readFileSync(e+r.pages[n]+".axml","utf-8");d=fs.readFileSync(e+r.pages[n]+".wxml","utf-8");d=$.Vnode.parseXml(d).toString(function(){switch(this.tagName){case"view":this.tagName="div";break;case"text":this.tagName="span";break;case"image":this.tagName="img";break;case"button":this.tagName="button_"}var e={};for(var t in this.attributes)if("a:if"===t)e["v-if"]=this.attributes["a:if"].replace("{{","").replace("}}","");else if("a:elif"===t)e["v-else-if"]=this.attributes["a:elif"].replace("{{","").replace("}}","");else if("a:else"===t)e["v-else"]=!0;else if("a:for"===t){var i=this.attributes["a:for"].replace("{{","").replace("}}",""),n=this.attributes["a:for-item"]||"item",r=this.attributes["a:for-index"]||"index";e["v-for"]="("+n+","+r+") in "+i}else if("a:key"===t)e.key=this.attributes["a:key"];else if("onTap"===t)e["@click"]=this.attributes.onTap;else if("onInput"===t)e["@change"]=this.attributes.onInput;else if("onLongTap"==t)e["@touchstart"]="on($event,'longpress','"+this.attributes.onLongTap+"')";else{this.attributes[t];/^on([A-Z])([a-z,A-Z]+)/.test(t)?e[t.replace(/^on([A-Z])(\w+)/,function(e,t,i){return"@"+t.toLowerCase()+i})]=this.attributes[t].replace("{{","").replace("}}",""):/^\{\{.+\}\}$/.test(this.attributes[t])?e[":"+("id"===t?"ref":t)]=this.attributes[t].replace(/^\{\{/,"").replace(/\}\}$/,""):"style"==t?e[":"+t]="computStyle('"+this.attributes[t]+"')":"a:for-item"!==t&&"a:for-index"!==t&&(e["id"===t?"ref":t]=this.attributes[t])}this.attributes=e}),d=a?'<div class="'+o+'">'+d+"</div>":"<template>"+d+"</template>",a?l=l.replace("G.component(Component,{",'window["'+o+'"]('+c+",{\r\ntemplate:'#TEMPLATE_"+o+"',\r\n"):(d+='\r\n<script type="text/javascript">\r\n'+l+"\r\n<\/script>",l=""),"-min"==min&&i&&(d=minify(d,minConfig),p=minify(p,minConfig),l=minify(l,minConfig)),d&&fs.writeFileSync(t+r.pages[n]+".html",d),fs.writeFileSync(t+r.pages[n]+".css",p),l&&fs.writeFileSync(t+r.pages[n]+".js",l)}(o)}function build_w_a(e,t,n,r){if(!fs.existsSync(e)||!fs.existsSync(t)||builded.w_a)return!1;e+="/",t+="/",builded.w_a=!0;var s=JSON.parse(fs.readFileSync(e+"app.json","utf-8")),a=["common.wxss","utils/common.js","app.js"];for(i=0;i<a.length;i++){var o=e+a[i],l=t+a[i].replace(/wxss/,"acss").replace(/wxml/,"axml");$.node.copyFile(o,l,r||{},function(e){return e.replace(/\.wxss/gim,".acss").replace(/wx\./gim,"my.")})}for($.node.copyFolder(e+"images",t+"images"),$.node.copyFolder(e+"assets",t+"assets"),i=0;i<s.pages.length;i++)!function(i){var n=0==s.pages[i].indexOf("components/");$.node.copyFile(e+s.pages[i]+".js",t+s.pages[i]+".js",function(e){return e=e.replace(/wx\./gim,"my."),n&&(e=e.replace("G.component({","G.component(Component,{")),e}),$.node.copyFile(e+s.pages[i]+".json",t+s.pages[i]+".json"),$.node.copyFile(e+s.pages[i]+".wxss",t+s.pages[i]+".acss",function(e){return e.replace(/\.wxss/gim,".acss")}),$.node.copyFile(e+s.pages[i]+".wxml",t+s.pages[i]+".axml",function(e){return e=(e=(e=e.replace(/\swx:/gim," a:")).replace(/\sbind([a-z])([a-z,A-Z]+)=/gim,function(e,t,i){return" on"+t.toUpperCase()+i+"="})).replace(/\sbind:(\w+)=/gim,function(e,t){return" on"+(t=t.charAt(0).toUpperCase()+t.substring(1,t.length))})})}(i)}function build(e,t,i,n,r){min=i,build_w_h(e+"WeChat",t+"H5",n,r),build_w_a(e+"WeChat",t+"Alipay",n,r),build_a_h(e+"Alipay",t+"H5",n,r)}"compile"==process.argv[2]?build("./","./","-min"==process.argv[3],!0):module.exports=build;